<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Plugin Development | Semo</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="A Node.js CLI building rules.">
    
    <link rel="preload" href="/assets/css/0.styles.acc2b136.css" as="style"><link rel="preload" href="/assets/js/app.1c3f0d45.js" as="script"><link rel="preload" href="/assets/js/2.ba92cd9d.js" as="script"><link rel="preload" href="/assets/js/1.c0f27cf5.js" as="script"><link rel="preload" href="/assets/js/33.372ad170.js" as="script"><link rel="prefetch" href="/assets/js/10.65819d39.js"><link rel="prefetch" href="/assets/js/11.39b543d7.js"><link rel="prefetch" href="/assets/js/12.03a05adf.js"><link rel="prefetch" href="/assets/js/13.ffc8bc69.js"><link rel="prefetch" href="/assets/js/14.67e6dbaa.js"><link rel="prefetch" href="/assets/js/15.52c1aed2.js"><link rel="prefetch" href="/assets/js/16.e0e89472.js"><link rel="prefetch" href="/assets/js/17.cda121ba.js"><link rel="prefetch" href="/assets/js/18.61c28edc.js"><link rel="prefetch" href="/assets/js/19.f58dfaa3.js"><link rel="prefetch" href="/assets/js/20.18b644bb.js"><link rel="prefetch" href="/assets/js/21.3b665101.js"><link rel="prefetch" href="/assets/js/22.9c8168b6.js"><link rel="prefetch" href="/assets/js/23.9f9f475a.js"><link rel="prefetch" href="/assets/js/24.3528886c.js"><link rel="prefetch" href="/assets/js/25.694039a0.js"><link rel="prefetch" href="/assets/js/26.dc762a2f.js"><link rel="prefetch" href="/assets/js/27.2f1ce92f.js"><link rel="prefetch" href="/assets/js/28.40e180e1.js"><link rel="prefetch" href="/assets/js/29.3a61faf7.js"><link rel="prefetch" href="/assets/js/3.5443cc84.js"><link rel="prefetch" href="/assets/js/30.5ccab1d6.js"><link rel="prefetch" href="/assets/js/31.63537216.js"><link rel="prefetch" href="/assets/js/32.be59bb9b.js"><link rel="prefetch" href="/assets/js/34.28a1467e.js"><link rel="prefetch" href="/assets/js/35.957d39a7.js"><link rel="prefetch" href="/assets/js/36.7b26797c.js"><link rel="prefetch" href="/assets/js/37.64eda9c6.js"><link rel="prefetch" href="/assets/js/38.552b9752.js"><link rel="prefetch" href="/assets/js/39.2e95795f.js"><link rel="prefetch" href="/assets/js/4.bf4516f2.js"><link rel="prefetch" href="/assets/js/40.220bcf70.js"><link rel="prefetch" href="/assets/js/41.1b54d9a1.js"><link rel="prefetch" href="/assets/js/42.64e4abd4.js"><link rel="prefetch" href="/assets/js/43.e405d5a4.js"><link rel="prefetch" href="/assets/js/44.4b7b61b3.js"><link rel="prefetch" href="/assets/js/45.b62ceb4b.js"><link rel="prefetch" href="/assets/js/46.9b2cdf33.js"><link rel="prefetch" href="/assets/js/47.a5264e5d.js"><link rel="prefetch" href="/assets/js/48.db61019b.js"><link rel="prefetch" href="/assets/js/49.49e6540b.js"><link rel="prefetch" href="/assets/js/5.4554aff1.js"><link rel="prefetch" href="/assets/js/50.e73c1873.js"><link rel="prefetch" href="/assets/js/51.5f5e6bff.js"><link rel="prefetch" href="/assets/js/6.f72b5c66.js"><link rel="prefetch" href="/assets/js/7.48b067b9.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.77260563.js">
    <link rel="stylesheet" href="/assets/css/0.styles.acc2b136.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><!----> <span class="site-name">Semo</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/en/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/en/usage/" class="nav-link">
  Usage
</a></div><div class="nav-item"><a href="http://semo.js.org/typedoc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Reference
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/plugin/" class="nav-link">
  zh-CN
</a></li><li class="dropdown-item"><!----> <a href="/en/guide/plugin/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li></ul></div></div> <a href="https://github.com/semojs/semo" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/en/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/en/usage/" class="nav-link">
  Usage
</a></div><div class="nav-item"><a href="http://semo.js.org/typedoc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Reference
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/plugin/" class="nav-link">
  zh-CN
</a></li><li class="dropdown-item"><!----> <a href="/en/guide/plugin/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li></ul></div></div> <a href="https://github.com/semojs/semo" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/guide/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/en/guide/quickstart/" class="sidebar-link">Quick Start</a></li><li><a href="/en/guide/core-commands/" class="sidebar-link">Core Commands</a></li><li><a href="/en/guide/custom-commands/" class="sidebar-link">Custom Commands</a></li><li><a href="/en/guide/config/" class="sidebar-link">Configuration Management</a></li><li><a href="/en/guide/hook/" class="sidebar-link">Hook Mechanism</a></li><li><a href="/en/guide/plugin/" aria-current="page" class="active sidebar-link">Plugin Development</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/guide/plugin/#quick-start" class="sidebar-link">Quick Start</a></li><li class="sidebar-sub-header"><a href="/en/guide/plugin/#adding-commands" class="sidebar-link">Adding Commands</a></li><li class="sidebar-sub-header"><a href="/en/guide/plugin/#implementing-hooks" class="sidebar-link">Implementing Hooks</a></li><li class="sidebar-sub-header"><a href="/en/guide/plugin/#exposing-methods" class="sidebar-link">Exposing Methods</a></li><li class="sidebar-sub-header"><a href="/en/guide/plugin/#publishing-plugins" class="sidebar-link">Publishing Plugins</a></li><li class="sidebar-sub-header"><a href="/en/guide/plugin/#plugin-hierarchy" class="sidebar-link">Plugin Hierarchy</a></li><li class="sidebar-sub-header"><a href="/en/guide/plugin/#running-remote-plugins-directly" class="sidebar-link">Running Remote Plugins Directly</a></li><li class="sidebar-sub-header"><a href="/en/guide/plugin/#special-home-directory-plugins" class="sidebar-link">Special Home Directory Plugins</a></li><li class="sidebar-sub-header"><a href="/en/guide/plugin/#recognizing-plugins-in-any-directory" class="sidebar-link">Recognizing Plugins in Any Directory</a></li><li class="sidebar-sub-header"><a href="/en/guide/plugin/#issue-with-internal-plugins-defined-in-applications-in-typescript-mode" class="sidebar-link">Issue with Internal Plugins Defined in Applications in Typescript Mode</a></li><li class="sidebar-sub-header"><a href="/en/guide/plugin/#plugin-s-active-registration-mechanism" class="sidebar-link">Plugin's Active Registration Mechanism</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Usage</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/usage/" class="sidebar-link">Overview</a></li><li><a href="/en/usage/plugin/" class="sidebar-link">Plugins</a></li><li><a href="/en/usage/integration/" class="sidebar-link">Project Integration</a></li><li><a href="/en/usage/solution/" class="sidebar-link">Solutions</a></li><li><a href="/en/usage/distribution/" class="sidebar-link">Distribution</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Community</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/community/contrib/" class="sidebar-link">How to Contribute</a></li><li><a href="/en/community/qa/" class="sidebar-link">Frequently Asked Questions</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="plugin-development"><a href="#plugin-development" class="header-anchor">#</a> Plugin Development</h1> <h2 id="quick-start"><a href="#quick-start" class="header-anchor">#</a> Quick Start</h2> <p>A <code>Semo</code> plugin is essentially a standard <code>Node</code> module, albeit with some conventions regarding directory and file structure. These conventions can be challenging to remember, so we provide various auxiliary tools for plugin developers or tool users, such as code generation. Here, we describe the recommended plugin development process. However, once you're familiar with the development process, you can also manually build a plugin from an empty directory.</p> <h3 id="step-1-create-plugin-directory-based-on-template"><a href="#step-1-create-plugin-directory-based-on-template" class="header-anchor">#</a> Step 1: Create Plugin Directory Based on Template</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>semo create semo-plugin-xyz <span class="token parameter variable">--template</span><span class="token operator">=</span>plugin
</code></pre></div><p>Here, we use the built-in plugin template. As mentioned earlier in configuration management, you can override the <code>repo</code> and <code>branch</code> options or the <code>--template</code> option to avoid passing default parameters each time.</p> <h3 id="step-2-enter-plugin-directory-and-execute-default-command-to-confirm-everything-is-fine"><a href="#step-2-enter-plugin-directory-and-execute-default-command-to-confirm-everything-is-fine" class="header-anchor">#</a> Step 2: Enter Plugin Directory and Execute Default Command to Confirm Everything is Fine</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> semo-plugin-xyz
semo hi
</code></pre></div><p>This is a command built into the plugin template. After initialization, you can execute it by entering the directory, confirming the initial interaction with the plugin command. If you see it respond with <code>Hey you!</code>, everything is ready, and you can proceed to write scripts that will truly change the world.</p> <h2 id="adding-commands"><a href="#adding-commands" class="header-anchor">#</a> Adding Commands</h2> <p>It's worth noting that this plugin template is based on <code>Typescript</code>, so you need some <code>Typescript</code> basics. We recommend keeping the <code>yarn watch</code> command running during development to compile in real-time while developing and testing simultaneously.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>semo generate <span class="token builtin class-name">command</span> xyz
</code></pre></div><p>Typically, there's a correlation between the plugin name and the commands it encapsulates. Here, we add an <code>xyz</code> command, but you can also modify the existing <code>hi</code> command. Once you've mastered plugin development, it's advisable to remove the default <code>hi</code> command.</p> <h2 id="implementing-hooks"><a href="#implementing-hooks" class="header-anchor">#</a> Implementing Hooks</h2> <p>Implementing hooks is another purpose of plugin development. Hooks are often defined by other plugins or business projects, and implementing hooks can influence and change the behavior of other plugins.</p> <p>Use the following command to query which hooks are supported in the current environment:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>semo hook list
</code></pre></div><h3 id="example-1-implementing-hook-create-project-template"><a href="#example-1-implementing-hook-create-project-template" class="header-anchor">#</a> Example 1: Implementing <code>hook_create_project_template</code></h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// src/hooks/index.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> semo__hook_create_project_template <span class="token operator">=</span> <span class="token punctuation">{</span>
  demo_repo<span class="token operator">:</span> <span class="token punctuation">{</span>
    repo<span class="token operator">:</span> <span class="token string">'demo_repo.git'</span><span class="token punctuation">,</span>
    branch<span class="token operator">:</span> <span class="token string">'master'</span><span class="token punctuation">,</span>
    alias<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'demo'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>With this hook, we can select a custom project template when executing the <code>semo create [PROJECT] --template</code> command, just by remembering the alias, without needing to remember the address. Another advantage is that you don't need to manage how each engineer sets the global <code>--repo</code> option on their personal computer. As long as the specified plugin is installed, everyone can initialize projects with the same project alias.</p> <h3 id="example-2-implementing-hook-repl"><a href="#example-2-implementing-hook-repl" class="header-anchor">#</a> Example 2: Implementing <code>hook_repl</code></h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// src/hooks/index.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">semo__hook_repl</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> a <span class="token operator">+</span> b
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">multiple</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> a <span class="token operator">*</span> b
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then, in the REPL environment, you can use these:</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Information returned by <code>hook_repl</code> is injected into the Semo object in the REPL.</p></div> <div class="language-bash extra-class"><pre class="language-bash"><code>semo repl
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">add</span>
<span class="token punctuation">[</span>Function: add<span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> await Semo.add<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> multiple
<span class="token punctuation">[</span>Function: multiple<span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> await Semo.multiple<span class="token punctuation">(</span><span class="token number">3</span>, <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token number">12</span>
</code></pre></div><p>The motivations behind implementing this hook differ between plugins and business projects. Business projects generally inject specific business logic, while plugins typically inject common methods with some degree of reusability, such as injecting instance methods of underlying services, commonly used libraries, etc. For example, the <code>Utils</code> core injection contains the <code>lodash</code> library.</p> <h2 id="exposing-methods"><a href="#exposing-methods" class="header-anchor">#</a> Exposing Methods</h2> <p>Another primary purpose of implementing plugins is to expose instances, methods, or libraries externally. In this case, we can define modules in a standard way, for example:</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Since <code>Semo</code> later introduced the <code>run</code> command, which depends on the entry file for locating, it requires plugins of <code>Semo</code> to declare an entry, regardless of whether this entry exposes methods.</p></div> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib/index.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// index.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>This approach is fine, but typically, modules defined in this way don't need to adhere to <code>Semo</code>'s conventions. As long as they comply with <code>node</code> and <code>npm</code> standards, they are acceptable. Here, <code>Semo</code> defines another way to expose methods based on the hook mechanism.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// src/hooks/index.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> semo__hook_component <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token string">'b'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Usage:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Utils <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@semo/core'</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> Utils<span class="token punctuation">.</span><span class="token function">invokeHook</span><span class="token punctuation">(</span><span class="token string">'semo:component'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment">// -&gt; 'b'</span>
</code></pre></div><p>With this approach, we can encapsulate some common methods of business projects for cross-project use. These common methods typically lean towards the lower level, such as various middlewares or underlying services.</p> <h2 id="publishing-plugins"><a href="#publishing-plugins" class="header-anchor">#</a> Publishing Plugins</h2> <p>After using commands, hooks, or</p> <p>library extensions, we've developed a <code>Semo</code> plugin. If you want to share your plugin with others, you need to do some preparation work.</p> <h3 id="_1-upload-code-to-a-git-repository"><a href="#_1-upload-code-to-a-git-repository" class="header-anchor">#</a> 1. Upload Code to a Git Repository</h3> <p>If it's open-source, you can choose <code>Github</code>. If it's an internal plugin, upload it to an internal repository, which could be a private <code>Github</code> repository or a company <code>Gitlab</code> repository.</p> <h3 id="_2-modify-package-json"><a href="#_2-modify-package-json" class="header-anchor">#</a> 2. Modify <code>package.json</code></h3> <p>Mainly modify the package name, version, license, repository address, homepage address, etc.</p> <p>If it's an internal plugin, you can modify the <code>registry</code> address in the <code>.npmrc</code> file.</p> <h3 id="_3-obtain-an-account-for-the-npm-registry-and-log-in"><a href="#_3-obtain-an-account-for-the-npm-registry-and-log-in" class="header-anchor">#</a> 3. Obtain an Account for the npm Registry and Log In</h3> <p>For open-source plugins, you can register at <code>https://npmjs.org</code>. For privately deployed npm repositories, you can get an account from your operations team.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> login <span class="token parameter variable">--registry</span><span class="token operator">=</span><span class="token punctuation">[</span>YOUR_REGISTRY<span class="token punctuation">]</span>
</code></pre></div><h3 id="_4-test-the-plugin-package"><a href="#_4-test-the-plugin-package" class="header-anchor">#</a> 4. Test the Plugin Package</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> pack --dry-run
</code></pre></div><p>Through packaging testing, check whether the package contains any unnecessary files, and adjust the configuration of the <code>.npmignore</code> file accordingly.</p> <h3 id="_5-publish-your-plugin"><a href="#_5-publish-your-plugin" class="header-anchor">#</a> 5. Publish Your Plugin</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> version <span class="token punctuation">[</span>patch<span class="token operator">|</span>minor<span class="token operator">|</span>major<span class="token punctuation">]</span>
<span class="token function">npm</span> publish
</code></pre></div><h3 id="_6-promote-your-plugin-and-share-development-insights"><a href="#_6-promote-your-plugin-and-share-development-insights" class="header-anchor">#</a> 6. Promote Your Plugin and Share Development Insights</h3> <p>Good documentation is crucial, as well as actively promoting and encouraging others to use and provide feedback on your plugin.</p> <h3 id="_7-actively-maintain"><a href="#_7-actively-maintain" class="header-anchor">#</a> 7. Actively Maintain</h3> <p>Any npm package can gradually become outdated or have security risks, so it's essential to actively maintain your plugin to ensure it functions as intended.</p> <h2 id="plugin-hierarchy"><a href="#plugin-hierarchy" class="header-anchor">#</a> Plugin Hierarchy</h2> <p>The <code>Semo</code> plugin system scans multiple locations to increase flexibility, with each level serving different purposes and restrictions.</p> <ul><li>Installed globally via <code>npm install -g semo-plugin-xxx</code>, so commands from installed plugins are globally available. This is the default global installation method for npm packages.</li> <li>Installed in the home directory's <code>.semo/home-plugin-cache</code> directory via <code>semo plugin install semo-plugin-xxx</code>, and the plugin commands are also globally available. In certain cases where the current user lacks permission to install globally via npm, this method can be used.</li> <li>Installed in the current project directory via <code>npm install semo-plugin-xxx</code>. Plugin commands installed this way are only effective within the current project.</li></ul> <p>Why would some plugins need to be installed globally? Because plugins can not only fulfill our project's business requirements but also serve as part of our development toolchain or even implement some non-business functionalities. With some imagination, any terminal functionality can be implemented, either completely handwritten or encapsulated and integrated with other excellent projects. Here, excellent projects are not limited to specific languages or language extension package repositories.</p> <h2 id="running-remote-plugins-directly"><a href="#running-remote-plugins-directly" class="header-anchor">#</a> Running Remote Plugins Directly</h2> <p>This is just an illusion; it still needs to be downloaded locally, but the download directory is different, avoiding interference with your implementation. You can freely test plugins you're interested in.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>semo run semo-plugin-serve
</code></pre></div><p>This plugin provides a simple HTTP service. The first time you run it, it will download, and subsequently, it will reuse the previously downloaded plugin. Use <code>--force</code> to force an update.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Subsequent development will include a feature to clean plugin caches.</p></div> <h2 id="special-home-directory-plugins"><a href="#special-home-directory-plugins" class="header-anchor">#</a> Special Home Directory Plugins</h2> <blockquote><p>This feature was introduced in <code>v0.8.0</code></p></blockquote> <p>To add global configurations to <code>Semo</code>, you need to add a <code>.semorc.yml</code> configuration file in the <code>~/.semo</code> directory. Once this configuration file is established, the <code>.semo</code> directory is automatically recognized as a global plugin (other global plugins are in the <code>.semo/home-plugin-cache</code> directory). Here, you can define your own commands, extend other plugins' commands, or extend other plugins' hooks, etc. This special plugin is globally recognizable. Also, because it's present by default, if you have some locally common logic and don't want to publish it as an npm package, you can quickly start here. However, be aware of its global availability, as errors here can affect the local global state.</p> <p>We don't prescribe a specific implementation approach for this special plugin. You can use <code>js</code> or <code>typescript</code> to write it. You can initialize the basic directory structure using <code>semo init</code>, or regenerate a <code>.semo</code> directory with the template using <code>semo create .semo --template=pluging</code> (backup the <code>.semo</code> directory in advance, then merge the contents back).</p> <h2 id="recognizing-plugins-in-any-directory"><a href="#recognizing-plugins-in-any-directory" class="header-anchor">#</a> Recognizing Plugins in Any Directory</h2> <p>We can see the <code>pluginDir</code> configuration in the configuration file. If you manually specify this parameter on the command line, you can achieve any specific directory purpose, and it also supports multiple directories:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>semo <span class="token builtin class-name">help</span> --plugin-dir<span class="token operator">=</span>dir1 --plugin-dir<span class="token operator">=</span>dir2
</code></pre></div><p>Additionally, it supports specifying via constants:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">SEMO_PLUGIN_DIR</span><span class="token operator">=</span>dir3 semo <span class="token builtin class-name">help</span>
</code></pre></div><h2 id="issue-with-internal-plugins-defined-in-applications-in-typescript-mode"><a href="#issue-with-internal-plugins-defined-in-applications-in-typescript-mode" class="header-anchor">#</a> Issue with Internal Plugins Defined in Applications in Typescript Mode</h2> <p>This is because <code>tsc</code> can only recognize <code>ts</code> and <code>js</code> related files during compilation and cannot recognize our <code>yml</code> format. Moreover, the official doesn't intend to support copying files other than <code>ts</code>. As <code>ts</code> is not a complete build tool, we need to manually copy the required files. This can be achieved using <code>cpy-cli</code> or <code>copyfiles</code>. Taking <code>copyfiles</code> as an example:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;copyfiles&quot;</span><span class="token operator">:</span> <span class="token string">&quot;copyfiles -u 1 -a src/**/*.yml dist -E&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="plugin-s-active-registration-mechanism"><a href="#plugin-s-active-registration-mechanism" class="header-anchor">#</a> Plugin's Active Registration Mechanism</h2> <blockquote><p>Introduced in <code>v1.3.0</code></p></blockquote> <p>In the early days, <code>Semo</code> only supported the automatic registration mechanism for plugins. To increase flexibility, it could traverse multiple locations, albeit with some IO performance loss. Therefore, the active registration mechanism was introduced. Once the active registration mechanism is used, the automatic registration mechanism becomes ineffective.</p> <h3 id="activation-method"><a href="#activation-method" class="header-anchor">#</a> Activation Method</h3> <p>Write plugin key-value pairs in the <code>$plugins</code> section of <code>.semorc.yml</code></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">$plugins</span><span class="token punctuation">:</span>
  <span class="token key atrule">register</span><span class="token punctuation">:</span>
    <span class="token key atrule">plugin-a</span><span class="token punctuation">:</span> /absolute/path
    <span class="token key atrule">plugin-b</span><span class="token punctuation">:</span> ./relative/path
    <span class="token key atrule">plugin-c</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>Three styles are supported: absolute paths, relative paths, and using Node.js module loading mechanisms for declaration. Here, the <code>semo-plugin-</code> prefix can be omitted for plugin names used as keys. Additionally, the shorthand <code>~</code> for the home directory is supported.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/semojs/semo/edit/master/docs/en/guide/plugin/README.md" target="_blank" rel="noopener noreferrer">Help improve this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/guide/hook/" class="prev">
        Hook Mechanism
      </a></span> <span class="next"><a href="/en/usage/">
        Overview
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1c3f0d45.js" defer></script><script src="/assets/js/2.ba92cd9d.js" defer></script><script src="/assets/js/1.c0f27cf5.js" defer></script><script src="/assets/js/33.372ad170.js" defer></script>
  </body>
</html>
