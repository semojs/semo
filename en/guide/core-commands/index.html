<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Core commands | Semo</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="A Node.js CLI building rules.">
    
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.7c4f29f4.js" as="script"><link rel="preload" href="/assets/js/2.c8f551f9.js" as="script"><link rel="preload" href="/assets/js/13.1360b7d9.js" as="script"><link rel="prefetch" href="/assets/js/10.e10ec60f.js"><link rel="prefetch" href="/assets/js/11.59c070fc.js"><link rel="prefetch" href="/assets/js/12.3ef0cef5.js"><link rel="prefetch" href="/assets/js/14.693e2c27.js"><link rel="prefetch" href="/assets/js/15.66434cd6.js"><link rel="prefetch" href="/assets/js/16.7f54cb8d.js"><link rel="prefetch" href="/assets/js/17.e35721d7.js"><link rel="prefetch" href="/assets/js/18.4bc54445.js"><link rel="prefetch" href="/assets/js/19.852f73df.js"><link rel="prefetch" href="/assets/js/20.137e95ab.js"><link rel="prefetch" href="/assets/js/21.07432b76.js"><link rel="prefetch" href="/assets/js/22.30f2f370.js"><link rel="prefetch" href="/assets/js/23.c2e02ffe.js"><link rel="prefetch" href="/assets/js/24.8c45e9e3.js"><link rel="prefetch" href="/assets/js/25.b89ad2b9.js"><link rel="prefetch" href="/assets/js/26.048fa03e.js"><link rel="prefetch" href="/assets/js/3.c94d9973.js"><link rel="prefetch" href="/assets/js/4.09fd2c39.js"><link rel="prefetch" href="/assets/js/5.b99a1609.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/7.f056ed1e.js"><link rel="prefetch" href="/assets/js/8.7f59801b.js"><link rel="prefetch" href="/assets/js/9.bd50b831.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><!----> <span class="site-name">Semo</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/en/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/usage/" class="nav-link">
  Usage
</a></div><div class="nav-item"><a href="http://semo.js.org/typedoc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Reference
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/core-commands/" class="nav-link">
  zh-CN
</a></li><li class="dropdown-item"><!----> <a href="/en/guide/core-commands/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li></ul></div></div> <a href="https://github.com/semojs/semo" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/en/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/usage/" class="nav-link">
  Usage
</a></div><div class="nav-item"><a href="http://semo.js.org/typedoc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Reference
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/core-commands/" class="nav-link">
  zh-CN
</a></li><li class="dropdown-item"><!----> <a href="/en/guide/core-commands/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  en-US
</a></li></ul></div></div> <a href="https://github.com/semojs/semo" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/guide/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/en/guide/quickstart/" class="sidebar-link">Get started</a></li><li><a href="/en/guide/core-commands/" aria-current="page" class="active sidebar-link">Core commands</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo" class="sidebar-link">semo</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-application" class="sidebar-link">semo application</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-cleanup" class="sidebar-link">semo cleanup</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-config" class="sidebar-link">semo config</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-hook" class="sidebar-link">semo hook</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-init" class="sidebar-link">semo init</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-create-name-repo-branch" class="sidebar-link">semo create  [repo] [branch]</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-generate-component" class="sidebar-link">semo generate &lt;component&gt;</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-plugin" class="sidebar-link">semo plugin</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-repl-replfile" class="sidebar-link">semo repl [replFile]</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-run-plugin-command" class="sidebar-link">semo run  [COMMAND]</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-script-file" class="sidebar-link">semo script [file]</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-shell" class="sidebar-link">semo shell</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-status" class="sidebar-link">semo status</a></li><li class="sidebar-sub-header"><a href="/en/guide/core-commands/#semo-completion" class="sidebar-link">semo completion</a></li></ul></li><li><a href="/guide/custom-commands/" class="sidebar-link">自定义命令</a></li><li><a href="/en/guide/config/" class="sidebar-link">Configuration</a></li><li><a href="/guide/hook/" class="sidebar-link">钩子机制</a></li><li><a href="/guide/plugin/" class="sidebar-link">插件开发</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Usage</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/usage/" class="sidebar-link">概述</a></li><li><a href="/usage/plugin/" class="sidebar-link">插件</a></li><li><a href="/usage/integration/" class="sidebar-link">项目整合</a></li><li><a href="/usage/solution/" class="sidebar-link">解决方案</a></li><li><a href="/usage/distribution/" class="sidebar-link">发行版</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Community</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/community/contrib/" class="sidebar-link">如何贡献</a></li><li><a href="/community/qa/" class="sidebar-link">常见问题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="core-commands"><a href="#core-commands" class="header-anchor">#</a> Core commands</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Translating...</p></div> <h2 id="semo"><a href="#semo" class="header-anchor">#</a> <code>semo</code></h2> <p>Semo provides default behavior to run any <code>Semo</code> command style file.</p> <div class="language- extra-class"><pre class="language-text"><code>semo command.js
</code></pre></div><p>Normally our commands do not have <code>.js</code> extension, so if you pass an argument with <code>.js</code> you must want to execute the file. If you run a <code>.ts</code> file, you need to construct <code>ts</code> environment, please refer to our FAQ about how to do it.</p> <p>What is this way used for? We can use this way to define scripts, then you combine the concepts of commands and scripts.You can define scripts first, then if they are used frequently, you can make a plugin with a proper name. We also have a plugin called <code>semo-plugin-script</code>, which is also used to define scripts, but it has a code template generator with will not be provided by <code>Semo</code> core.</p> <h2 id="semo-application"><a href="#semo-application" class="header-anchor">#</a> <code>semo application</code></h2> <blockquote><p>alias: <code>app</code></p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>This command has been migrated to <code>semo-plugin-application</code>.</p></div> <p>By default this command does not have any functionalities. it's just a convention, suggest that you add your application commands under <code>semo application</code>. Your application need to add commands by using <code>semo</code> command extension feature.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> semo-plugin-application
semo generate <span class="token builtin class-name">command</span> application/test --extend<span class="token operator">=</span>application
</code></pre></div><p>In this way, it add an <code>test</code> command for <code>semo application</code>, and you can run it by <code>semo application test</code></p> <p>By running <code>semo application help</code>, you can see all top level commands in this project. Because you may have many commands in many levels, so you may need to run help command very often.</p> <h2 id="semo-cleanup"><a href="#semo-cleanup" class="header-anchor">#</a> <code>semo cleanup</code></h2> <blockquote><p>alias: clean</p></blockquote> <p>This command is used to clean some <code>Semo</code> internal files, e.g. repl command history, shell command history, repl temp downloaded files, run command temp downloaded files, and global plugin directories and files.</p> <p>For now, it only supports a limited extension, and only allows applications defining clean directories, but not support plugins adding clean directories for security reasons.</p> <h2 id="semo-config"><a href="#semo-config" class="header-anchor">#</a> <code>semo config</code></h2> <p>We can use this command to view and modify config, including project config and global config.</p> <div class="language- extra-class"><pre class="language-text"><code>semo config &lt;op&gt;

Manage rc config

命令：
  semo config delete &lt;configKey&gt;                                Delete configs by key                     [aliases: del]
  semo config get &lt;configKey&gt;                                   Get configs by key
  semo config list                                              List configs                   [默认值] [aliases: ls, l]
  semo config set &lt;configKey&gt; &lt;configValue&gt; [configComment]     Set config by key
  [configType]

Options:
  --global, -g  For reading/writing configs from/to global yml rc file, default is false
  --watch       Watch config change, maybe only work on Mac
</code></pre></div><p>Here, <code>&lt;configKey&gt;</code>'s format is <code>a.b.c</code>, means hierarchical config. It also supports adding comments to the last level config.</p> <h2 id="semo-hook"><a href="#semo-hook" class="header-anchor">#</a> <code>semo hook</code></h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>This command has been migrated to <code>semo-plugin-hook</code></p></div> <p>This command's output shows all available hooks in current environment, all implemented hooks can be invoked. You can see the hook name, description, and definition location.</p> <div class="language- extra-class"><pre class="language-text"><code>Hook                         :  Package :  Description                                     
  hook_beforeCommand           :  semo    :  Hook triggered before command execution.        
  hook_afterCommand            :  semo    :  Hook triggered after command execution.         
  hook_component               :  semo    :  Hook triggered when needing to fetch component 
  hook_hook                    :  semo    :  Hook triggered in hook command.                 
  hook_repl                    :  semo    :  Hook triggered in repl command.                 
  hook_status                  :  semo    :  Hook triggered in status command.               
  hook_create_project_template :  semo    :  Hook triggered in create command.  
</code></pre></div><p>Here you can see a special hook <code>hook_hook</code>, using this hook to declare new hooks. Any plugin can declare its own hooks, and other plugins can hook them to influence plugin behaviors. Most of applications projects do not need to declare hooks, except it need to build their application level plugin system.</p> <p>Another thing to note, it's not necessary to declare hooks before using, declaration code is just for clarification.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Maybe we do not allow to invoke non-declared hooks in the future.</p></div> <h2 id="semo-init"><a href="#semo-init" class="header-anchor">#</a> <code>semo init</code></h2> <blockquote><p>alias: <code>i</code></p></blockquote> <p>This command is for initialization for projects or plugins, these two scenarios have a little differences.</p> <p>In application projects, we put <code>Semo</code> directory into <code>bin</code> under the project root.</p> <div class="language- extra-class"><pre class="language-text"><code>├── .semorc.yml
├── bin
│   └── semo
│       ├── commands
│       ├── extends
│       ├── hooks
│       ├── plugins
│       └── scripts
└── package.json

</code></pre></div><p>But in plugin project, we put all code into <code>src</code> directory.</p> <div class="language- extra-class"><pre class="language-text"><code>├── .semorc.yml
├── src
│    ├── commands
│    ├── extends
│    ├── hooks
└── package.json
</code></pre></div><p>This command is to save developers seconds to init a project. It's OK to create those files and directories manually.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The structure and usage of <code>.semorc.yml</code> is located at <code>Configuration management</code> section.</p></div> <p>If we want to build a new plugin, it is still not so easy to do, here we suggest using project template as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>semo create semo-plugin-xxx --template=plugin
</code></pre></div><p>Obviously, there are more templates. Please refer to the <code>create</code> command.</p> <h2 id="semo-create-name-repo-branch"><a href="#semo-create-name-repo-branch" class="header-anchor">#</a> <code>semo create &lt;name&gt; [repo] [branch]</code></h2> <blockquote><p>alias: <code>c</code></p></blockquote> <p>This command is different from <code>generate</code> and <code>init</code> command. It's used to create a new project directory. It can be application projects or plugin projects. It has some options to control.</p> <div class="language- extra-class"><pre class="language-text"><code>$ semo create help

semo create &lt;name&gt; [repo] [branch]

Create a create project from specific repo

选项：
  --version      显示版本号                                                                                       [布尔]
  --yarn         use yarn command                                                                        [默认值: false]
  --yes, -y      run npm/yarn init with --yes                                                             [默认值: true]
  --force, -F    force download, existed folder will be deleted!
  --merge, -M    merge config with exist project folder!
  --empty, -E    force empty project, ignore repo
  --template, -T   select from default repos
  --add, -A      add npm package to package.json dependencies                                            [默认值: false]
  --add-dev, -D  add npm package to package.json devDependencies                                         [默认值: false]
  --init-semo, -i     init new project
  -h, --help     显示帮助信息                                                                                     [布尔]
</code></pre></div><p>The above are specific command descriptions, and next we describe the some senarios.</p> <h3 id="initialize-project-from-any-repo"><a href="#initialize-project-from-any-repo" class="header-anchor">#</a> Initialize project from any repo</h3> <div class="language- extra-class"><pre class="language-text"><code>semo create PROJECT_NAME PROJECT_REPO_URL master -f
</code></pre></div><p>We use <code>create</code> command to download code from any git repo, that means any git repo can be our project template. <code>master</code> is the default branch name, so we can ignore it, <code>-f</code> means <code>--force</code>, it will override existed directory.</p> <h3 id="create-an-empty-project-no-project-template"><a href="#create-an-empty-project-no-project-template" class="header-anchor">#</a> Create an empty project, no project template</h3> <div class="language- extra-class"><pre class="language-text"><code>semo create PROJECT_NAME -yfie
</code></pre></div><p>The <code>-yfie</code> means <code>-y -f -i -e</code>, it's a <code>yargs</code> feature.</p> <blockquote><p><code>-i</code> is to run <code>semo init</code> automatically.
<code>-y</code> is to answer <code>yes</code> when creating <code>package.json</code>.
<code>-f</code> is to override exsited directories.
<code>-e</code> is to tell it's just an empty repo.</p></blockquote> <p>The structure is as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>├── .semorc.yml
├── bin
│   └── semo
│       ├── commands
│       ├── extends
│       ├── hooks
│       ├── plugins
│       └── scripts
└── package.json
</code></pre></div><h3 id="create-a-semo-plugin-directory"><a href="#create-a-semo-plugin-directory" class="header-anchor">#</a> Create a <code>Semo</code> plugin directory</h3> <p>If we do not base on code template repo, we can create basic plugin structure manually.</p> <div class="language- extra-class"><pre class="language-text"><code>semo create semo-plugin-[PLUGIN_NAME] -yfie
</code></pre></div><p>It's similar with the above case, except that project name has a <code>plugin</code> convention. If the project name starts with <code>semo-plugin-</code>, then <code>Semo</code> knows it's a plugin project intialization, and <code>semo init --plugin</code> executed automatically.</p> <p>The structure of this project is:</p> <div class="language- extra-class"><pre class="language-text"><code>├── .semorc.yml
├── package.json
└── src
    ├── commands
    ├── extends
    └── hooks
</code></pre></div><h3 id="基于内置模板创建项目"><a href="#基于内置模板创建项目" class="header-anchor">#</a> 基于内置模板创建项目</h3> <p>If we create a project by running follow command:</p> <div class="language- extra-class"><pre class="language-text"><code>semo create PROJECT_NAME --template
</code></pre></div><p>Then we'll see the output as follows:</p> <div class="language- extra-class"><pre class="language-text"><code>? Please choose a pre-defined repo to continue: (Use arrow keys)
❯ semo_plugin_starter [semo-plugin-starter, plugin]
❯ ...
</code></pre></div><p>Here you can choose an internal template, and do not need to input repo any URLs. there is a default plugin template, and you can add more templates by implementing <code>hook_create_project_template</code></p> <p>Here is a simple demo code. For more details about Semo hooks, please refer to relative docs.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> hook_create_project_template <span class="token operator">=</span> <span class="token punctuation">{</span>
  demo_repo<span class="token operator">:</span> <span class="token punctuation">{</span>
    repo<span class="token operator">:</span> <span class="token string">'demo_repo.git'</span><span class="token punctuation">,</span>
    branch<span class="token operator">:</span> <span class="token string">'master'</span><span class="token punctuation">,</span>
    alias<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'demo'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you already know the template identifier, you can use it in commands as follows:</p> <div class="language- extra-class"><pre class="language-text"><code>semo create PROJECT_NAME --template=demo
semo create PROJECT_NAME --template=demo_repo
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When you create a business application or a plugin, it's not suggested to build from scratch. Because you need to think about many things like CICD, lint, test and so on. You can come up with your own code template and make the template better and create new project from it.</p></div> <p>The rest of options are all easy to understand, <code>--yarn</code> means install deps by <code>yarn</code>, <code>--add</code> and <code>--add-dev</code> are to set new deps. <code>--merge</code> means it will not delete old project but init in project directory.</p> <h2 id="semo-generate-component"><a href="#semo-generate-component" class="header-anchor">#</a> <code>semo generate &lt;component&gt;</code></h2> <blockquote><p>alias: <code>generate</code>, <code>g</code></p></blockquote> <p>This command is a code generator, <code>Semo</code> defines command, plugin, and script generator, and plugins of <code>Semo</code> can create their own generators under <code>generate</code> sub command. e.g. controller, model, migration, unit test and so on. It's best to keep same style in a team.</p> <div class="language- extra-class"><pre class="language-text"><code>$ semo generate help

semo generate &lt;component&gt;

Generate component sample code

命令：
  semo generate command &lt;name&gt; [description]               Generate a command template
  semo generate plugin &lt;name&gt;                              Generate a plugin structure
  semo generate script &lt;name&gt;                              Generate a script file

选项：
  --version   Show version                                                                                         [Boolean]
  -h, --help  Show help                                                                                      [Boolean]
</code></pre></div><h3 id="扩展-generate-命令添加子命令"><a href="#扩展-generate-命令添加子命令" class="header-anchor">#</a> 扩展 <code>generate</code> 命令添加子命令</h3> <p>和上面扩展 <code>application</code> 命令的方法是一样的：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>semo generate <span class="token builtin class-name">command</span> generate/test --extend<span class="token operator">=</span>semo
</code></pre></div><p>具体怎么实现这些代码生成命令，这里是没有做约束的，因为首先 es6 内置的模板字符串机制可以解决大多数问题，然后 <code>Semo</code> 还内置了 <code>lodash</code>，其 <code>_.template</code> 方法也比较灵活，最后只要把组装好的样板代码放到想放的位置即可。</p> <p>因为这部分都是基于 <code>Semo</code> 的，所以相关的配置建议放到 <code>.semorc.yml</code> 文件，例如自动生成的配置里就有的：</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">commandDir</span><span class="token punctuation">:</span> src/commands
<span class="token key atrule">extendDir</span><span class="token punctuation">:</span> src/extends
<span class="token key atrule">hookDir</span><span class="token punctuation">:</span> src/hooks
</code></pre></div><p>可以看到，<code>create</code> 命令生成默认配置也仅仅是约定了一些代码自动生成的目录，同时也给出一种定义目录的配置风格，如果想保持配置的一致性，可以用同样的风格定义其他目录。</p> <h2 id="semo-plugin"><a href="#semo-plugin" class="header-anchor">#</a> <code>semo plugin</code></h2> <blockquote><p>alias: p</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这条命令已经转移到 <code>semo-plugin-plugin</code> 插件</p></div> <p>这个命令用于安装在家目录的全局插件，也可以用于优化当前项目的 semo 执行效率。</p> <div class="language- extra-class"><pre class="language-text"><code>$ semo plugin help
semo plugin

Plugin management tool

命令：
  semo p install &lt;plugin&gt;    Install plugin                                                                 [aliases: i]
  semo p list                List all plugins                                                           [aliases: l, ls]
  semo p uninstall &lt;plugin&gt;  Uninstall plugin                                                              [aliases: un]
</code></pre></div><h2 id="semo-repl-replfile"><a href="#semo-repl-replfile" class="header-anchor">#</a> <code>semo repl [replFile]</code></h2> <blockquote><p>alias: <code>r</code></p></blockquote> <p>REPL(read-eval-print-loop)：交互式解析器，每一个现代的编程语言大概都有这类交互环境，在里面我们可以写一些简单的代码，做为一个快速了解和学习语言特性的工具。但是当 REPL 可以和框架或者业务项目结合以后，可以发挥出更大的作用。</p> <h3 id="对-repl-的一些扩展"><a href="#对-repl-的一些扩展" class="header-anchor">#</a> 对 <code>REPL</code> 的一些扩展</h3> <p>在开发Semo 和这个脚手架时，Node 的 REPL 还不支持 <code>await</code>，这里是模拟实现了这个机制，目的是可以触发执行项目中的一些 promise 或 generator 方法。通过这个能力，再加上我们可以把一些业务代码注入到 <code>REPL</code> 我们就可以在接口控制器，脚本，单元测试之外多了一种执行方式，而这种执行方式还是交互式的。</p> <h3 id="为-repl-注入新的对象"><a href="#为-repl-注入新的对象" class="header-anchor">#</a> 为 <code>REPL</code> 注入新的对象</h3> <p>这里需要实现内置的 <code>hook_repl</code> 钩子，并且在业务项目的声明的钩子目录配置： <code>hookDir</code>，下面代码仅供参考。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/hooks/index.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">hook_repl</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> a <span class="token operator">+</span> b
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">multiple</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> a <span class="token operator">*</span> b
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>然后在 REPL 环境，就可以使用了:</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>hook_repl</code> 返回的信息都注入到了 REPL 里的 Semo 对象。</p></div> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt;&gt; add
[Function: add]
&gt;&gt;&gt; await Semo.add(1, 2)
3
&gt;&gt;&gt; multiple
[Function: multiple]
&gt;&gt;&gt; await Semo.multiple(3, 4)
12
</code></pre></div><p>在实际的业务项目中，会把项目中的公共方法，工具函数等等都注入进去，这对开发以及后面的排查问题都是很有帮助的。默认 <code>Semo</code> 把自己的 <code>Utils</code> 工具对象注入进去了，里面有一些是 <code>Semo</code> 自定义的工具函数，更多的是把 <code>Semo</code> 引入的依赖包暴露出来，比如 <code>lodash</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在具体的实践中，我们把数据库，缓存，OSS，Consul, ElasticSearch 等等多种公司的基础设施注入了进来，写成插件，使得我们更容易的直接访问基础设施。</p></div> <h3 id="重新载入一遍钩子文件"><a href="#重新载入一遍钩子文件" class="header-anchor">#</a> 重新载入一遍钩子文件</h3> <p><code>.reload</code> 或者 <code>Semo.reload()</code> 可以重新执行一遍 <code>hook_repl</code> 钩子，然后把最新的结果注入 Semo。这个的用途是希望在不退出 REPL 环境的情况下能够调用最新的钩子结果，这里只能保证重新加载和执行钩子文件本身，如果钩子内部用了  <code>require</code> 还是会被缓存，这部分就需要用户自己来处理了，比如每次 <code>require</code> 之前先尝试删除 <code>require.cache</code></p> <h3 id="临时试用-npm-包"><a href="#临时试用-npm-包" class="header-anchor">#</a> 临时试用 npm 包</h3> <p>在 REPL 下支持用 <code>Semo.import</code> 临时下载和调试一些包，这个调试包下载不会进入当前项目的 node_modules 目录。(还有一个等价方法是：Semo.require)</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt;&gt; let _ = Semo.import('lodash')
&gt;&gt;&gt; _.VERSION
</code></pre></div><h4 id="使用内部命令的方式"><a href="#使用内部命令的方式" class="header-anchor">#</a> 使用内部命令的方式</h4> <blockquote><p>v1.5.14 新增
<code>.require</code> 和 <code>.import</code> 是等价的，可以快速导入一些常用包用于调试，例如：</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt;&gt; .import lodash:_ dayjs:day
</code></pre></div><p>冒号后面的是别名，意思是导入后存成什么变量名。</p> <h3 id="释放对象的属性到-repl-环境"><a href="#释放对象的属性到-repl-环境" class="header-anchor">#</a> 释放对象的属性到 REPL 环境</h3> <div class="language- extra-class"><pre class="language-text"><code>&gt;&gt;&gt; Semo.extract(Semo)
</code></pre></div><p>这个操作的潜在风险就是会覆盖 REPL 环境里内置的对象，但是这个 API 的目的和作用是释放一些明确的对象，比如从 ORM 里释放一个数据库中所有的表模型。</p> <p>这个操作也支持在配置中进行，比如要将 Semo 对象里的 <code>Utils</code> 注入进去，可以在配置文件中配置：</p> <div class="language- extra-class"><pre class="language-text"><code>$plugin:
  semo:
    extract: Semo
</code></pre></div><p>这种方式会把 Semo 下的所有属性都注入进去，如果只想注入 <code>Utils</code>，支持这么写。</p> <div class="language- extra-class"><pre class="language-text"><code>$plugin:
  semo:
    extract:
      Semo: [Utils]
</code></pre></div><h3 id="semo-对象简介"><a href="#semo-对象简介" class="header-anchor">#</a> Semo 对象简介</h3> <p>最早的时候本来打算核心和插件可以自由的注入到 REPL 环境，后来觉得不可控，所以决定核心和插件都只能注入到 <code>Semo</code> 对象。下面说一下 Semo 对象的结构</p> <ul><li>Semo.hooks 为了对各个插件的信息进行隔离，所有插件注入的信息按照插件名称注入到这里，各个插件不会相互干扰</li> <li>Semo.argv 这个是进入命令的 <code>yargs</code> argv参数，有时可以用于看看配置合并是否生效，以及实验 yargs 的参数解析。</li> <li>Semo.repl 当前 REPL 环境的对象实例</li> <li>Semo.Utils 核心工具包，里面除了自定义的若干函数之外，会暴露出一些常用的第三方包，比如 <code>lodash</code>, <code>chalk</code> 等</li> <li>Semo.reload 重新执行 <code>hook_repl</code> 钩子，使用最新的钩子文件</li> <li>Semo.import 用于临时实验一些 npm 包， 可以用 <code>semo cleanup</code> 清理缓存</li> <li>Semo.extract 用于释放内部对象的键值到当前作用域，可以算作是把所有钩子的注入都放到 <code>Semo</code> 对象的一个补偿</li></ul> <h3 id="默认注入到全局作用域的方法"><a href="#默认注入到全局作用域的方法" class="header-anchor">#</a> 默认注入到全局作用域的方法</h3> <p>如果觉得默认的对象层次比较深，可以通过配置或者参数使得默认注入到 REPL 的全局作用域。方式就是 <code>--extract</code></p> <div class="language- extra-class"><pre class="language-text"><code>semo repl --extract Semo.hooks
</code></pre></div><p>配置的方式: 修改 <code>.semorc.yml</code></p> <div class="language- extra-class"><pre class="language-text"><code>$plugin:
  semo:
    extract: Semo.hooks
</code></pre></div><p>或</p> <div class="language- extra-class"><pre class="language-text"><code>CommandDefault:
  repl:
    extract: Semo.hooks
</code></pre></div><h3 id="支持执行一个repl文件"><a href="#支持执行一个repl文件" class="header-anchor">#</a> 支持执行一个repl文件</h3> <p>用途也是执行逻辑后将一些结果注入到REPL，文件也是Node模块，需要符合指定格式。</p> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">argv<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 或者</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">argv<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>需要注意，只有通过 <code>context</code> 才能注入到 REPL，如果你的代码不放到函数当中，也是可以执行的，但是不能获取到之前其他逻辑注入到context中的内容，也不同获得 <code>argv</code> 对象，另外，必须通过 <code>global</code> 对象注入到REPL当中。</p> <p>这个机制有什么作用呢？主要用途是在我们开发调试时，有一些想在REPL里进行的调试是有许多前置逻辑的，如果都在REPL里一行一行的输入太麻烦，所以通过这种方式就可以把调试逻辑固化下来。</p> <p>还有一个角度是: <code>semo repl --require</code> 这种方式，如果全局设置会比较固定，不宜太多，而通过命令行设置又需要每次都输入，不够方便，利用执行脚本的方式，我们可以灵活的组织逻辑，将我们想要注入的常用工具库注入，甚至在注入之前还可以做一番设置，部分可以取代之前的 <code>--require</code> 机制和 hook 机制。</p> <h2 id="semo-run-plugin-command"><a href="#semo-run-plugin-command" class="header-anchor">#</a> <code>semo run &lt;PLUGIN&gt; [COMMAND]</code></h2> <p>这个命令可以像 yarn create 一样，实现直接执行远程插件包里的命令的效果</p> <p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>semo run semo-plugin-serve serve
</code></pre></div><p>这里是调用了 semo-plugin-serve 插件实现简单的 HTTP 服务，也许我们会觉得这样写起来还是不是很方便，那么我们可以简化一下。</p> <div class="language- extra-class"><pre class="language-text"><code>semo run serve
</code></pre></div><p>这样看是不是简洁多了，这里能把 <code>semo-plugin-</code> 省略的原因是这里只支持 semo 系列插件，而不是所有的 npm 包，所以可以内部帮着加上，而后面的 serve 命令去掉是因为插件为此实现了一个约定，插件就是一个普通的 node 包，可以对外暴露方法，这里暴露了一个 handler 方法，而这个 handler 方法又去掉了包里的 serve 命令，因为这个命令文件也是一个 Node 模块。如果插件里面包含多个命令，可以用这个机制对外暴露最常用的，其他的还是应该明确传参。另外，需要注意的是一些命令需要传递参数，这里需要把所有的参数和选项都改造成选项。</p> <p>之前是命令的时候：</p> <div class="language- extra-class"><pre class="language-text"><code>semo serve [publicDir]
</code></pre></div><p>在用 <code>run</code> 命令调度时：注意，插件命令里的参数需要放到 <code>--</code> 后</p> <div class="language- extra-class"><pre class="language-text"><code>semo run serve -- --public-dir=.
</code></pre></div><p>如果你在 npm 的 semo 插件包也是在 scope 下的，在用 run 时需要指定 scope</p> <div class="language- extra-class"><pre class="language-text"><code>semo run xxx --SCOPE yyy
</code></pre></div><p><code>run</code> 命令运行的插件肯定是缓存到本地了，只不过不在全局插件目录 <code>.semo/node_modules</code>, 而是在 <code>.semo/run_plugin_cache/node_modules</code> 目录，默认如果存在就会用缓存里的插件，如果想更新需要用参数 --upgrade</p> <div class="language- extra-class"><pre class="language-text"><code>semo run serve --UPGRADE|--UP
</code></pre></div><p>有些插件可能依赖于另一些插件，如果有这种情况，就需要手动指定依赖插件，实现一起下载，为什么不能基于 npm 的依赖关系呢，可以看一下下面这个例子：</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>此特性 v0.8.2 引入</p></div> <div class="language- extra-class"><pre class="language-text"><code>semo run read READ_URL --format=editor --DEP=read-extend-format-editor
</code></pre></div><p>editor 这个插件在开发时是依赖于 read 的，但是在运行时，read 指定的参数却是 editor 这个插件实现的，所以只能手动指定依赖了。</p> <p>你可能已经发现这个命令的所有参数和选项都是大写的，这是为了减少与其他插件的冲突，我们最好约定所有的插件的参数和选项都用小写。</p> <h2 id="semo-script-file"><a href="#semo-script-file" class="header-anchor">#</a> <code>semo script [file]</code></h2> <blockquote><p>alias: <code>scr</code></p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这条命令已经转移到 <code>semo-plugin-script</code> 插件</p></div> <p>很多时候我们都需要跑一些脚本，这些脚本是在项目服务之外的，需要我们主动触发，可能是做数据迁移，可能是数据导出，可能是数据批量修改，也可能是执行业务逻辑，比如发邮件，发短信，发通知等等。在遇到这样的需求的时候，我们都需要写脚本，但是我们会遇到几个问题：</p> <ul><li>放哪里</li> <li>怎么写</li> <li>脚本参数怎么解析</li></ul> <p>很多时候这些需求都是一次性的，或者有前提的，不是很适合写成命令，不然命令就太多了，在这种场景下，<code>Semo</code> 通过这条命令给出了一个统一的方案。</p> <h3 id="放哪里"><a href="#放哪里" class="header-anchor">#</a> 放哪里</h3> <p>在配置中有一个 <code>scriptDir</code>，默认是 <code>src/scripts</code>，我们默认把脚本都放到这里，因为这些脚本不会被服务访问到，所以没必要和项目核心逻辑放的太近。</p> <h3 id="怎么写-怎么解析参数"><a href="#怎么写-怎么解析参数" class="header-anchor">#</a> 怎么写，怎么解析参数</h3> <p>当然可以手动建脚本，然后用这个命令来触发，但是因脚本还需要起名字，而且还有一定的格式要求，所以，推荐使用 <code>semo generate script</code> 命令来生成。</p> <div class="language- extra-class"><pre class="language-text"><code>semo generate script test
</code></pre></div><p>自动生成的样板代码及文件名：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/bin/semo/scripts/20191025130716346_test.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">builder</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">yargs<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// yargs.option('option', {default, describe, alias})</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">argv<span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Start to draw your dream code!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，作为一个脚本，不是一上来就写业务逻辑，也不需要声明 <code>shebang</code> 标识，只需要定义两个方法，一个是 <code>builder</code>，一个是 <code>handler</code>。其中 <code>builder</code> 用于声明脚本的参数，格式可以参考 <code>yargs</code>，如果脚本不需要参数，其实也可以不定义，由于是模板自动生成，放到那里即可，以备不时之需。<code>handler</code> 是具体的执行逻辑，传入的参数就是解析好的脚本参数，也包含了项目的 <code>.semorc.yml</code> 里的配置。可以看到 <code>handler</code> 支持 <code>async</code> 所以这里可以执行一些异步操作。</p> <p>所以，脚本和命令最大的区别其实就是使用的频率，以及业务的定位，我们经常做的分层是定义原子命令，然后在脚本中调度。</p> <h2 id="semo-shell"><a href="#semo-shell" class="header-anchor">#</a> <code>semo shell</code></h2> <blockquote><p>alias: <code>sh</code></p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这条命令已经转移到 <code>semo-plugin-shell</code> 插件</p></div> <p>这个命令是个很简单的命令，目的是不用每次敲命令都输入前面的 <code>semo</code>，例如：</p> <div class="language- extra-class"><pre class="language-text"><code>semo shell
&gt; status
&gt; hook
&gt; repl
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>semo shell --prefix=git
&gt; log
&gt; remote -v
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>semo: prefix=git
git: log
</code></pre></div><h2 id="semo-status"><a href="#semo-status" class="header-anchor">#</a> <code>semo status</code></h2> <blockquote><p>alias: <code>st</code></p></blockquote> <p>这个命令的作用很简单，就是看 <code>Semo</code> 当前所处的环境，例如：</p> <div class="language- extra-class"><pre class="language-text"><code>$ semo st
  version  :  1.8.17
  location :  ~/.nvm/versions/node/[VERSION]/lib/node_modules/semo
  os       :  macOS 10.15
  node     :  8.16.2
  npm      :  6.4.1
  yarn     :  1.15.2
  hostname :  [MY_HOST]
  home     :  [MY_HOME]
  shell    :  [MY_SHELL]
</code></pre></div><p>这里实现了一个 hook， <code>hook_status</code>，实现了这个 hook 的插件，可以在这里展示插件的相关信息，如果是业务项目实现了这个钩子，也可以在这里显示项目信息。</p> <h2 id="semo-completion"><a href="#semo-completion" class="header-anchor">#</a> <code>semo completion</code></h2> <p>这个命令的作用是输出一段 <code>Shell</code> 脚本，放到 <code>.bashrc</code> 或者 <code>.zshrc</code> 里，就能够获得子命令的自动补全效果。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>由于 <code>Semo</code> 的性能有些差，所以这个自动补全虽然能用，但是体验极差，不建议使用。</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/semojs/semo/edit/master/docs/en/guide/core-commands/README.md" target="_blank" rel="noopener noreferrer">Help improve this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/guide/quickstart/" class="prev">
        Get started
      </a></span> <span class="next"><a href="/guide/custom-commands/">
        自定义命令
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7c4f29f4.js" defer></script><script src="/assets/js/2.c8f551f9.js" defer></script><script src="/assets/js/13.1360b7d9.js" defer></script>
  </body>
</html>
